# SHA-1 지문 등록이 필요한 이유

## 질문
"전화번호로 SMS가 가는데, 왜 SHA-1 지문을 등록해야 하나?"

## 답변

### SMS 전송과 SHA-1 지문은 별개의 보안 단계입니다

Firebase Phone Authentication은 **두 단계의 보안 검증**을 거칩니다:

```
1. 앱 검증 (SHA-1 지문 필요) ← 지금 여기서 막힘
   ↓
2. SMS 전송 (전화번호로 실제 전송)
```

## 상세 설명

### 1단계: 앱 검증 (Play Integrity / reCAPTCHA)

**목적**: Firebase가 "이 앱이 정당한 앱인가?"를 확인

**방법**:
- Google Play Integrity API 사용
- 앱의 서명 인증서(SHA-1/SHA-256) 확인
- Firebase Console에 등록된 지문과 일치하는지 검증

**왜 필요한가?**
- 악성 앱이 Firebase 서비스를 남용하는 것을 방지
- 무단 SMS 발송으로 인한 비용 발생 방지
- 보안 강화

**현재 오류의 의미**:
```
"This request is missing a valid app identifier"
= "이 앱이 Firebase에 등록된 정당한 앱인지 확인할 수 없음"
```

### 2단계: SMS 전송

**목적**: 인증 코드를 실제 전화번호로 전송

**방법**:
- Firebase가 SMS 서비스 제공업체를 통해 전송
- 전화번호로 실제 SMS 발송

**이 부분은 정상 작동합니다**:
- 전화번호 입력 → 해당 번호로 SMS 전송 ✅
- 하지만 1단계(앱 검증)에서 막혀서 SMS까지 도달하지 못함 ❌

## 비유로 설명

### 우체국에 편지 보내기

1. **앱 검증 (SHA-1)**: 우체국 직원이 "당신이 정당한 사람인가요?" 확인
   - 신분증(SHA-1 지문) 제시 필요
   - 신분증이 없으면 → 편지 접수 거부

2. **SMS 전송**: 편지를 받는 사람의 주소(전화번호)로 발송
   - 주소만 있으면 발송 가능
   - 하지만 1단계를 통과해야 함

**현재 상황**:
- 주소(전화번호)는 정확함 ✅
- 하지만 신분증(SHA-1)이 없어서 우체국에서 거부 ❌

## 실제 동작 흐름

### SHA-1 지문이 등록되지 않은 경우:

```
사용자: "010-1111-2222로 인증 코드 보내줘"
   ↓
Firebase: "앱 검증 시작..."
   ↓
Firebase: "이 앱의 SHA-1 지문이 등록되어 있지 않음"
   ↓
Firebase: "Play Integrity 검사 실패"
   ↓
Firebase: "reCAPTCHA 검사 실패"
   ↓
오류 발생: "This request is missing a valid app identifier"
   ↓
SMS 전송 단계까지 도달하지 못함 ❌
```

### SHA-1 지문이 등록된 경우:

```
사용자: "010-1111-2222로 인증 코드 보내줘"
   ↓
Firebase: "앱 검증 시작..."
   ↓
Firebase: "SHA-1 지문 확인... ✅"
   ↓
Firebase: "Play Integrity 검사 통과 ✅"
   ↓
Firebase: "reCAPTCHA 검사 통과 ✅"
   ↓
Firebase: "SMS 전송 시작..."
   ↓
SMS 전송 성공 ✅
```

## 테스트 전화번호와의 관계

### 테스트 전화번호 (`+821011112222`):
- Firebase Console에 등록된 번호
- 실제 SMS를 보내지 않고 설정한 인증 코드(`111111`) 사용
- **하지만 앱 검증(SHA-1)은 여전히 필요함**

### 프로덕션 전화번호:
- 실제 SMS 발송
- **앱 검증(SHA-1) 필수**

## 결론

**SHA-1 지문 등록은**:
- ✅ SMS가 전화번호로 가는 것과는 별개
- ✅ Firebase가 앱을 신뢰할 수 있도록 하는 보안 검증
- ✅ SMS 전송 **전**에 수행되는 필수 단계
- ✅ 테스트 전화번호를 사용해도 필요함

**SMS 전송은**:
- ✅ 전화번호로 정확히 전송됨 (이 부분은 문제 없음)
- ✅ 하지만 앱 검증을 통과해야만 가능

## 요약

| 단계 | 목적 | 필요한 것 | 현재 상태 |
|------|------|-----------|----------|
| 앱 검증 | 앱이 정당한지 확인 | SHA-1 지문 등록 | ❌ 막힘 |
| SMS 전송 | 전화번호로 코드 전송 | 전화번호 | ✅ 정상 |

**따라서 SHA-1 지문을 등록해야 SMS 전송 단계까지 도달할 수 있습니다.**
