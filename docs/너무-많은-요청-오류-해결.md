# "너무 많은 요청" 오류 해결 방법

## 오류 메시지
```
너무 많은 요청이 발생했습니다. 잠시 후 다시 시도해주세요.
```

## 원인

이 오류는 Firebase의 **rate limiting**에 걸렸을 때 발생합니다. 주로:

1. **SHA-1 지문 미등록**: Play Integrity 검사 실패로 인한 반복 요청
2. **테스트 전화번호 미등록**: Firebase Console에 테스트 번호가 없어서 실제 SMS 시도
3. **짧은 시간 내 반복 요청**: 너무 빠르게 여러 번 시도

## 즉시 해결 방법

### 1단계: Firebase Console에서 테스트 번호 확인 (가장 중요!)

1. [Firebase Console](https://console.firebase.google.com/) 접속
2. 프로젝트 선택: **howareyou-1c5de**
3. **Authentication** → **Sign-in method** → **전화번호** 클릭
4. **테스트 전화번호** 섹션 확인

#### 확인해야 할 것:
- ✅ `+821011112222` / `111111` (보호자) 등록되어 있는가?
- ✅ `+821033334444` / `333333` (보호 대상자) 등록되어 있는가?

### 2단계: 테스트 번호 재등록

테스트 번호가 없거나 잘못 등록된 경우:

1. **기존 테스트 번호 모두 삭제**
2. **새로 추가**:
   - 전화번호: `+821011112222` (또는 `+82 10-1111-2222`)
   - 인증 코드: `111111`
   - **추가** 버튼 클릭
3. **두 번째 번호 추가**:
   - 전화번호: `+821033334444` (또는 `+82 10-3333-4444`)
   - 인증 코드: `333333`
   - **추가** 버튼 클릭
4. **저장** 확인

### 3단계: SHA-1 지문 등록 (필수)

테스트 번호만으로는 해결되지 않는 경우, SHA-1 지문 등록이 필요합니다.

#### Android Studio Terminal에서:
```powershell
cd android
.\gradlew signingReport
```

출력에서 `SHA1:` 라인 찾아 복사

#### Firebase Console에 등록:
1. Firebase Console → 프로젝트 설정
2. 내 앱 → Android 앱 선택
3. SHA 인증서 지문 → 지문 추가
4. SHA-1 지문 입력
5. 저장

### 4단계: 잠시 대기 후 재시도

Rate limiting에 걸렸다면:
- **5-10분 정도 대기** 후 다시 시도
- 또는 Firebase Console에서 프로젝트 재시작

### 5단계: 앱 재시작

```powershell
# 앱 완전 종료 후 재실행
flutter run -d emulator-5554
```

## 예방 방법

### 1. 테스트 번호 사용
- Firebase Console에 테스트 번호를 등록하면 실제 SMS가 전송되지 않습니다
- Rate limiting에 걸릴 가능성이 낮아집니다

### 2. SHA-1 지문 등록
- Play Integrity 검사를 통과하면 rate limiting이 완화됩니다
- 테스트 번호를 사용해도 SHA-1 지문 등록을 권장합니다

### 3. 요청 간격 유지
- 인증 코드 전송 실패 후 즉시 재시도하지 마세요
- 최소 10-30초 간격을 두고 시도하세요

## 체크리스트

- [ ] Firebase Console에 테스트 번호가 등록되어 있는가?
- [ ] 전화번호 형식이 `+821011112222`인가?
- [ ] 인증 코드가 정확히 `111111`인가?
- [ ] SHA-1 지문이 Firebase Console에 등록되어 있는가?
- [ ] 5-10분 대기 후 다시 시도했는가?
- [ ] 앱을 재시작했는가?

## Firebase Rate Limits

Firebase Phone Authentication의 제한:
- **IP당 시간당**: 150건
- **IP당 분당**: 50건
- **전체 분당**: 1,000건

테스트 번호를 사용하면 이 제한에 걸릴 가능성이 낮아집니다.

## 참고

- 테스트 전화번호를 사용해도 때로는 SHA-1 지문이 필요합니다
- Rate limiting은 보안을 위한 것이므로, 테스트 번호와 SHA-1 지문을 모두 설정하는 것이 좋습니다
- 오류가 계속 발생하면 Firebase Console에서 프로젝트 상태를 확인하세요
