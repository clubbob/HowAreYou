# 100만명 이용자 비용 계산 (현재 개발 상태 기준)

**계산 일자**: 2026-02-06  
**기준**: 현재 개발된 앱 상태 (하루 1회 기록, 로컬 알림 19:00)

---

## 시나리오 가정

- **총 회원**: 1,000,000명
- **보호대상자(subject)**: 500,000명
- **보호자(guardian)**: 500,000명
- **보호대상자당 평균 보호자 수**: 1.5명
- **각 보호대상자 응답 빈도**: 하루 1회 (매일 19:00 알림 후 기록)
- **월 기준**: 30일
- **신규 가입**: 월 100,000명 (성장 단계 시나리오)

---

## 월간 사용량 계산

### 1. Firebase Authentication (전화번호 SMS 인증)

**신규 가입 시 SMS 발송:**
- 신규 가입: 월 100,000명
- SMS 발송: 월 100,000건 (가입 시 1회)
- 성공한 인증: 약 95,000건 (95% 성공률 가정)

**무료 할당량:**
- 월 10,000회 성공한 인증까지 무료

**초과분:**
- 95,000 - 10,000 = **85,000건**

**비용:**
- 가격: $0.06 per SMS (한국 기준)
- 비용: 85,000 × $0.06 = **$5,100/월** (약 6,630,000원)

---

### 2. 보호대상자 상태 기록

**기록 횟수:**
- 보호대상자 500,000명 × 30일 = **15,000,000회/월**

---

### 3. Firestore 쓰기

**쓰기 발생:**
- `prompts/{date}` 문서 생성/업데이트: 15,000,000회
- 실패 토큰 제거 시 쓰기: 약 5% (750,000회)
- 사용자 문서 업데이트 (FCM 토큰 등): 약 1,000,000회
- **총 쓰기: 16,750,000회/월**

**무료 할당량:**
- 일일 20,000회 = 월 600,000회 무료

**초과분:**
- 16,750,000 - 600,000 = **16,150,000회**

**비용:**
- 가격: $0.09 per 100,000 writes
- 비용: (16,150,000 / 100,000) × $0.09 = **$14.535/월** ≈ **$14.54/월**

---

### 4. Firestore 읽기

**읽기 발생:**
- Cloud Functions 내부:
  - `subjects/{subjectId}` 문서 읽기: 15,000,000회
  - `users/{guardianUid}` 문서 읽기: 15,000,000 × 1.5 = 22,500,000회
- 앱 내부:
  - 보호대상자 조회: 500,000명 × 월 10회 × 7일 = 35,000,000회
  - 보호자 조회: 500,000명 × 월 5회 × 1.5명 × 7일 = 26,250,000회
- **총 읽기: 98,750,000회/월**

**무료 할당량:**
- 일일 50,000회 = 월 1,500,000회 무료

**초과분:**
- 98,750,000 - 1,500,000 = **97,250,000회**

**비용:**
- 가격: $0.03 per 100,000 reads
- 비용: (97,250,000 / 100,000) × $0.03 = **$29.175/월** ≈ **$29.18/월**

---

### 5. Firestore 저장

**저장량 계산:**
- 보호대상자 500,000명 × 하루 1회 × 30일 = 15,000,000 문서/월
- 문서당 평균 크기: 약 200 bytes (mood, answeredAt, slot, note)
- 월 저장량: 15,000,000 × 200 bytes = 3 GB
- **누적 저장량 (1년 후)**: 약 36 GB

**무료 할당량:**
- 1 GB 무료

**비용:**
- 첫 달: (3 - 1) GB × $0.18/GB = **$0.36/월**
- 1년 후: (36 - 1) GB × $0.18/GB = **$6.30/월**

---

### 6. Cloud Functions 실행

**함수 실행:**
- `onResponseCreated/onResponseUpdated` 트리거: 15,000,000회/월
- 함수 실행 시간: 평균 1-2초/회 (보호자 조회 + FCM 발송)
- 메모리 사용량: 256MB (0.256 GB)

**GB-초 계산:**
- 15,000,000회 × 0.256 GB × 2초 = **7,680,000 GB-초/월**

**무료 할당량:**
- 월 400,000 GB-초 무료
- 실행 횟수: 월 2,000,000회 무료

**초과분:**
- GB-초: 7,680,000 - 400,000 = **7,280,000 GB-초**
- 실행 횟수: 15,000,000 - 2,000,000 = **13,000,000회 초과**

**비용:**
- GB-초 가격: $0.0000025 per GB-초
- 실행 횟수 가격: $0.40 per 1M invocations
- GB-초 비용: 7,280,000 × $0.0000025 = **$18.20/월**
- 실행 횟수 비용: (13,000,000 / 1,000,000) × $0.40 = **$5.20/월**
- **총 Cloud Functions 비용: $23.40/월**

---

### 7. Firebase Cloud Messaging (FCM)

**알림 발송:**
- 보호자 알림: 15,000,000건/월 (보호대상자 기록 시)
- **비용: 무료** ✅ (FCM은 무제한 무료)

---

### 8. 로컬 알림 (보호대상자)

**알림 발송:**
- 매일 19:00 로컬 알림: 500,000명 × 30일 = 15,000,000건/월
- **비용: 무료** ✅ (로컬 알림, Firebase 비용 없음)

---

## 총 비용 계산

| 항목 | 월 사용량 | 무료 할당량 | 초과분 | 월 비용 (USD) | 월 비용 (KRW) |
|------|----------|------------|--------|--------------|--------------|
| Authentication SMS | 95,000건 | 10,000건 | 85,000건 | $5,100.00 | 6,630,000원 |
| Firestore 읽기 | 98,750,000회 | 1,500,000회 | 97,250,000회 | $29.18 | 37,934원 |
| Firestore 쓰기 | 16,750,000회 | 600,000회 | 16,150,000회 | $14.54 | 18,902원 |
| Firestore 저장 | 3 GB | 1 GB | 2 GB | $0.36 | 468원 |
| Cloud Functions GB-초 | 7,680,000 | 400,000 | 7,280,000 | $18.20 | 23,660원 |
| Cloud Functions 실행 | 15,000,000회 | 2,000,000회 | 13,000,000회 | $5.20 | 6,760원 |
| FCM | 무제한 | 무제한 | - | $0.00 | 0원 |
| 로컬 알림 | 무제한 | 무제한 | - | $0.00 | 0원 |
| **총계** | - | - | - | **$5,167.68** | **약 6,716,724원** |

**환율 기준**: 1 USD = 1,300 KRW

---

## 비용 분석

### 주요 비용 항목
1. **Authentication SMS**: $5,100/월 (98.7%) ⚠️ **가장 큰 비용**
2. **Firestore 읽기**: $29.18/월 (0.6%)
3. **Cloud Functions GB-초**: $18.20/월 (0.4%)
4. **Firestore 쓰기**: $14.54/월 (0.3%)
5. **Cloud Functions 실행**: $5.20/월 (0.1%)
6. **Firestore 저장**: $0.36/월 (0.0%)

### 비용 효율성
- **회원당 월 비용**: $5,167.68 / 1,000,000 = **$0.00517** (약 **6.72원**)
- **보호대상자당 월 비용**: $5,167.68 / 500,000 = **$0.01034** (약 **13.43원**)

---

## 비용 최적화 방안

### 1. Authentication SMS 최적화 (가장 중요) ⚠️

**현재 문제:**
- 월 100,000명 신규 가입 시 SMS 비용이 매우 큼 ($5,100/월)

**최적화 방안:**
- **자동 로그인 유지**: 한 번 로그인하면 재인증 최소화
- **소셜 로그인 추가**: Google/Apple 로그인 옵션 제공 (SMS 비용 없음)
- **월 가입 제한**: 초기에는 월 10,000명 이하로 유지 (무료 할당량 내)

**예상 절감:**
- 월 가입 10,000명으로 제한: $5,100 → $0
- **절감액: $5,100/월** (98.7% 절감)

### 2. Firestore 읽기 최적화

**현재 문제:**
- 앱 내부 조회가 많음 (98,750,000회/월)

**최적화 방안:**
- 보호자 토큰을 `subjects/{subjectId}` 문서에 캐시하여 읽기 감소
- 앱 내부 조회 최적화 (캐싱, 배치 읽기)
- 불필요한 조회 제거

**예상 절감:**
- 읽기: 97,250,000회 → 약 30,000,000회
- **절감액: 약 $20.18/월**

### 3. Cloud Functions 실행 시간 최적화

**현재 문제:**
- 평균 실행 시간 2초 (병렬 처리 미흡)
- 실행 횟수가 매우 많음 (15,000,000회/월)

**최적화 방안:**
- 보호자별 FCM 발송을 병렬 처리로 개선
- 실행 시간: 2초 → 1초로 단축
- 배치 처리로 실행 횟수 감소

**예상 절감:**
- GB-초: 7,680,000 → 3,840,000
- 실행 횟수: 15,000,000 → 15,000,000 (트리거이므로 감소 어려움)
- GB-초 비용: $18.20 → $8.60
- **절감액: 약 $9.60/월**

### 4. Firestore 쓰기 최적화

**현재 문제:**
- 실패 토큰 제거 시 쓰기 발생 (750,000회)
- 사용자 문서 업데이트 (1,000,000회)

**최적화 방안:**
- 토큰 제거를 배치 처리로 변경
- 불필요한 문서 업데이트 최소화

**예상 절감:**
- 쓰기: 16,750,000회 → 약 15,000,000회
- 초과분: 16,150,000회 → 14,400,000회
- **절감액: 약 $1.58/월**

---

## 최적화 후 총 비용

### 시나리오 A: SMS 최적화 (월 가입 10,000명)

| 항목 | 최적화 전 | 최적화 후 | 절감액 |
|------|----------|----------|--------|
| Authentication SMS | $5,100.00 | $0.00 | $5,100.00 |
| Firestore 읽기 | $29.18 | $9.00 | $20.18 |
| Firestore 쓰기 | $14.54 | $12.96 | $1.58 |
| Cloud Functions GB-초 | $18.20 | $8.60 | $9.60 |
| Cloud Functions 실행 | $5.20 | $5.20 | $0.00 |
| Firestore 저장 | $0.36 | $0.36 | $0.00 |
| **총계** | **$5,167.68** | **$36.72** | **$5,130.96** |

**한화 환산:**
- 최적화 전: 약 6,716,724원/월
- 최적화 후: 약 47,736원/월
- **절감액: 약 6,668,988원/월 (99.3% 절감)**

### 시나리오 B: SMS 최적화 없이 다른 최적화만 적용

| 항목 | 최적화 전 | 최적화 후 | 절감액 |
|------|----------|----------|--------|
| Authentication SMS | $5,100.00 | $5,100.00 | $0.00 |
| Firestore 읽기 | $29.18 | $9.00 | $20.18 |
| Firestore 쓰기 | $14.54 | $12.96 | $1.58 |
| Cloud Functions GB-초 | $18.20 | $8.60 | $9.60 |
| Cloud Functions 실행 | $5.20 | $5.20 | $0.00 |
| Firestore 저장 | $0.36 | $0.36 | $0.00 |
| **총계** | **$5,167.68** | **$5,136.12** | **$31.56** |

**한화 환산:**
- 최적화 전: 약 6,716,724원/월
- 최적화 후: 약 6,676,956원/월
- **절감액: 약 39,768원/월 (0.6% 절감)**

---

## 결론

### 현재 구조 (최적화 전)
- **월 비용: 약 6,716,724원** ($5,167.68)
- **회원당 월 비용: 약 6.72원**
- **주요 비용: Authentication SMS (98.7%)** ⚠️

### 최적화 후 (SMS 최적화 포함)
- **월 비용: 약 47,736원** ($36.72)
- **회원당 월 비용: 약 0.048원**
- 거의 무료 수준 (무료 할당량 내에서 대부분 처리)

### 주요 특징
1. **Authentication SMS가 가장 큰 비용**: 월 가입이 많을수록 비용 급증
2. **FCM은 완전 무료**: 알림 발송 비용 없음
3. **로컬 알림 무료**: 보호대상자 알림 비용 없음
4. **최적화 효과 큼**: SMS 최적화만으로도 99.3% 비용 절감 가능

### 권장 사항
1. **Authentication SMS 최적화 필수** (가장 중요)
   - 자동 로그인 유지
   - 소셜 로그인 옵션 추가
   - 월 가입 10,000명 이하로 유지 (무료 할당량 내)
2. **Firestore 읽기 최적화** (보호자 토큰 캐싱, 앱 내부 조회 최적화)
3. **Cloud Functions 병렬 처리** (실행 시간 단축)
4. **비용 모니터링 설정** (Firebase Console)
5. **정기적인 비용 리뷰** (월 1회)

---

## 추가 시나리오

### 시나리오 A: 월 가입 50,000명
- Authentication SMS: 47,500건 성공
- 무료 할당량: 10,000건
- 초과분: 37,500건
- 비용: 37,500 × $0.06 = **$2,250/월** (약 2,925,000원)
- **총 비용: 약 $2,303/월** (약 2,993,900원)

### 시나리오 B: 월 가입 10,000명 (무료 할당량 내)
- Authentication SMS: 9,500건 성공
- 무료 할당량: 10,000건
- 초과분: 0건
- 비용: **$0.00/월** ✅
- **총 비용: 약 $68/월** (약 88,400원)

### 시나리오 C: 1년 후 누적 저장량
- Firestore 저장: 36 GB
- 무료 할당량: 1 GB
- 초과분: 35 GB
- 비용: 35 × $0.18 = **$6.30/월** (약 8,190원)

**1년 후 총 비용 (월 가입 10,000명 기준):**
- 기존 비용: $36.72
- 저장 비용 추가: $6.30
- **총계: 약 $43.02/월** (약 55,926원)

---

## 참고사항

- 위 비용은 **미국 동부(us-central1)** 기준입니다
- 다른 지역(아시아, 유럽)은 가격이 다를 수 있습니다
- 실제 사용량은 사용자 행동 패턴에 따라 달라질 수 있습니다
- 무료 할당량은 프로젝트당 1개 데이터베이스에만 적용됩니다
- Authentication SMS는 성공한 인증만 카운트됩니다 (실패한 인증은 비용 없음)
- **100만명 규모에서는 Authentication SMS 비용이 전체 비용의 98.7%를 차지하므로, SMS 최적화가 필수입니다**
