# 로그인 전화번호 정책 검토

## 사용자의 질문
"한 번 로그인 성공한 후, 로그아웃했다가 다시 로그인할 때 자신의 핸드폰 번호를 입력해야만 로그인 가능하게 해야 하는지? 다른 사람의 핸드폰 번호로 로그인하면 안 되는 것 아닌가?"

## 현재 시스템 동작 방식

### Firebase Authentication 동작
- 전화번호로 인증하면 **고유한 UID**가 생성됩니다
- 같은 전화번호 = 같은 UID (같은 계정)
- 다른 전화번호 = 다른 UID (다른 계정)

### 현재 앱의 동작
- **어떤 전화번호든** 입력 가능
- 다른 사람의 번호로도 로그인 가능 (해당 번호의 계정으로 로그인됨)
- Firestore의 `users` 컬렉션에 `phone` 필드가 저장됨
- 보호자-보호 대상자 관계는 전화번호로 연결됨

## 실제 서비스에서의 일반적인 패턴

### 패턴 1: 자유로운 전화번호 입력 (대부분의 서비스)
**예시**: 카카오톡, 네이버, 인스타그램 등

**특징**:
- 어떤 전화번호든 입력 가능
- 다른 번호로도 로그인 가능
- 번호 변경 시 새 번호로 로그인 가능

**장점**:
- ✅ 번호 변경 시 유연함
- ✅ 여러 기기 사용 가능
- ✅ 사용자 편의성 높음
- ✅ 계정 복구 용이

**단점**:
- ❌ 다른 사람 번호로 로그인 가능 (보안 위험)
- ❌ 실수로 다른 번호 입력 시 다른 계정 접근

### 패턴 2: 기기 고정 방식 (일부 금융/보안 앱)
**예시**: 일부 금융 앱, 기업용 앱

**특징**:
- 한 번 로그인한 번호만 사용 가능
- 다른 번호 입력 시 차단 또는 경고

**장점**:
- ✅ 보안 강화
- ✅ 실수 방지
- ✅ 계정 무결성 유지

**단점**:
- ❌ 번호 변경 시 문제 발생
- ❌ 여러 기기 사용 어려움
- ❌ 사용자 불편함 증가
- ❌ 계정 복구 어려움

## 이 앱의 특성 분석

### 앱의 핵심 기능
1. **보호자-보호 대상자 관계**: 전화번호로 연결됨
2. **Firestore 저장**: `users` 컬렉션에 `phone` 필드 저장
3. **관계 형성**: 보호 대상자가 보호자 전화번호로 지정

### 잠재적 문제 시나리오

#### 시나리오 1: 다른 사람 번호로 로그인
- 사용자 A가 사용자 B의 번호로 로그인
- 결과: 사용자 B의 계정으로 로그인됨
- 문제: 사용자 B의 보호 대상자 정보를 볼 수 있음 (보안 위험)

#### 시나리오 2: 번호 변경
- 사용자가 번호를 변경함
- 현재 시스템: 새 번호로 새 계정 생성
- 문제: 기존 보호자-보호 대상자 관계 손실

#### 시나리오 3: 여러 기기 사용
- 사용자가 폰을 바꿈
- 현재 시스템: 새 번호로 새 계정 생성 또는 같은 번호로 로그인
- 문제: 기기 변경 시 불편함

## 권장 정책 (실제 서비스 기준)

### ✅ 권장: **하이브리드 방식** (가장 합리적)

#### 1. 기본 동작: 자유로운 전화번호 입력 유지
- 어떤 전화번호든 입력 가능
- 이유: 번호 변경, 여러 기기 사용 등 실제 사용 시나리오 대응

#### 2. 보안 강화: 추가 인증 단계
- **첫 로그인 시**: 전화번호 + SMS 인증 코드
- **재로그인 시**: 
  - 같은 번호: 바로 로그인 (자동 로그인 유지)
  - 다른 번호: **경고 다이얼로그** 표시
    - "다른 전화번호로 로그인하시겠습니까? 기존 계정과 다른 계정으로 로그인됩니다."
    - 확인 후 로그인 진행

#### 3. 계정 연동 기능 (선택사항)
- 번호 변경 시: 기존 계정과 새 번호 연동 옵션 제공
- 또는: 계정 이전 기능 제공

### ❌ 비권장: 완전 제한 방식
- 한 번 로그인한 번호만 사용 가능하게 제한
- 이유: 실제 사용 시 번호 변경, 기기 변경 등으로 인한 불편함

## 구현 방안

### 방안 1: 경고 다이얼로그 (권장)
```dart
// 로그인 시 이전에 사용한 번호와 다르면 경고
if (previousPhone != null && previousPhone != currentPhone) {
  // 경고 다이얼로그 표시
  showDialog(
    content: '다른 전화번호로 로그인하시겠습니까? 
              기존 계정과 다른 계정으로 로그인됩니다.',
  );
}
```

### 방안 2: 번호 변경 감지 및 안내
- SharedPreferences에 마지막 로그인 번호 저장
- 다른 번호 입력 시 경고 표시
- 사용자 확인 후 진행

### 방안 3: 계정 이전 기능
- 번호 변경 시 기존 계정 데이터를 새 번호로 이전
- 복잡하지만 사용자 편의성 최대화

## 결론 및 권장사항

### ✅ 최종 권장 정책:

1. **기본 동작**: 어떤 전화번호든 입력 가능 (현재 유지)
2. **보안 강화**: 다른 번호 입력 시 경고 다이얼로그 표시
3. **사용자 안내**: 명확한 메시지로 다른 계정임을 알림
4. **자동 로그인**: 같은 번호는 자동 로그인 유지 (현재 동작)

### 이유:
- ✅ 실제 사용 시나리오 대응 (번호 변경, 기기 변경)
- ✅ 보안 강화 (경고로 실수 방지)
- ✅ 사용자 편의성 유지
- ✅ 대부분의 서비스가 사용하는 패턴

### 구현 우선순위:
1. **높음**: 경고 다이얼로그 추가
2. **중간**: 마지막 로그인 번호 저장 및 비교
3. **낮음**: 계정 이전 기능 (나중에 필요 시)

## 참고: 실제 서비스 사례

### 카카오톡, 네이버
- 어떤 번호든 입력 가능
- 다른 번호 입력 시 다른 계정으로 로그인
- 사용자가 주의해서 입력하도록 UI로 안내

### 금융 앱 (일부)
- 기기 고정 또는 추가 인증
- 하지만 번호 변경 시 고객센터 연락 필요

### 이 앱의 경우
- 보호자-보호 대상자 관계가 중요하지만
- 번호 변경, 기기 변경 등 실제 시나리오 고려 필요
- **경고 다이얼로그로 보안 강화 + 사용자 편의성 유지**가 최선
