# 10만명 이용자 비용 계산 (현재 개발 상태 기준)

**계산 일자**: 2026-02-06  
**기준**: 현재 개발된 앱 상태 (하루 1회 기록, 로컬 알림 19:00)

---

## 시나리오 가정

- **총 회원**: 100,000명
- **보호대상자(subject)**: 50,000명
- **보호자(guardian)**: 50,000명
- **보호대상자당 평균 보호자 수**: 1.5명
- **각 보호대상자 응답 빈도**: 하루 1회 (매일 19:00 알림 후 기록)
- **월 기준**: 30일
- **신규 가입**: 월 10,000명 (초기 런칭 시나리오)

---

## 월간 사용량 계산

### 1. Firebase Authentication (전화번호 SMS 인증)

**신규 가입 시 SMS 발송:**
- 신규 가입: 월 10,000명
- SMS 발송: 월 10,000건 (가입 시 1회)
- 성공한 인증: 약 9,500건 (95% 성공률 가정)

**무료 할당량:**
- 월 10,000회 성공한 인증까지 무료

**비용:**
- 사용량: 9,500건
- 무료 할당량: 10,000건
- **초과분: 0건**
- **비용: $0.00/월** ✅

**참고**: 초기 런칭 후 월 가입이 10,000명 이하로 유지되면 계속 무료입니다.

---

### 2. 보호대상자 상태 기록

**기록 횟수:**
- 보호대상자 50,000명 × 30일 = **1,500,000회/월**

---

### 3. Firestore 쓰기

**쓰기 발생:**
- `prompts/{date}` 문서 생성/업데이트: 1,500,000회
- 실패 토큰 제거 시 쓰기: 약 5% (75,000회)
- 사용자 문서 업데이트 (FCM 토큰 등): 약 100,000회
- **총 쓰기: 1,675,000회/월**

**무료 할당량:**
- 일일 20,000회 = 월 600,000회 무료

**초과분:**
- 1,675,000 - 600,000 = **1,075,000회**

**비용:**
- 가격: $0.09 per 100,000 writes
- 비용: (1,075,000 / 100,000) × $0.09 = **$0.9675/월** ≈ **$0.97/월**

---

### 4. Firestore 읽기

**읽기 발생:**
- Cloud Functions 내부:
  - `subjects/{subjectId}` 문서 읽기: 1,500,000회
  - `users/{guardianUid}` 문서 읽기: 1,500,000 × 1.5 = 2,250,000회
- 앱 내부:
  - 보호대상자 조회: 50,000명 × 월 10회 × 7일 = 3,500,000회
  - 보호자 조회: 50,000명 × 월 5회 × 1.5명 × 7일 = 2,625,000회
- **총 읽기: 9,875,000회/월**

**무료 할당량:**
- 일일 50,000회 = 월 1,500,000회 무료

**초과분:**
- 9,875,000 - 1,500,000 = **8,375,000회**

**비용:**
- 가격: $0.03 per 100,000 reads
- 비용: (8,375,000 / 100,000) × $0.03 = **$2.5125/월** ≈ **$2.51/월**

---

### 5. Firestore 저장

**저장량 계산:**
- 보호대상자 50,000명 × 하루 1회 × 30일 = 1,500,000 문서/월
- 문서당 평균 크기: 약 200 bytes (mood, answeredAt, slot, note)
- 월 저장량: 1,500,000 × 200 bytes = 300 MB
- **누적 저장량 (1년 후)**: 약 3.6 GB

**무료 할당량:**
- 1 GB 무료

**비용:**
- 첫 달: 300 MB < 1 GB → **$0.00/월** ✅
- 1년 후: (3.6 - 1) GB × $0.18/GB = **$0.468/월** ≈ **$0.47/월**

---

### 6. Cloud Functions 실행

**함수 실행:**
- `onResponseCreated/onResponseUpdated` 트리거: 1,500,000회/월
- 함수 실행 시간: 평균 1-2초/회 (보호자 조회 + FCM 발송)
- 메모리 사용량: 256MB (0.256 GB)

**GB-초 계산:**
- 1,500,000회 × 0.256 GB × 2초 = **768,000 GB-초/월**

**무료 할당량:**
- 월 400,000 GB-초 무료
- 실행 횟수: 월 2,000,000회 무료

**초과분:**
- GB-초: 768,000 - 400,000 = **368,000 GB-초**
- 실행 횟수: 1,500,000 < 2,000,000 → **0회 초과**

**비용:**
- 가격: $0.0000025 per GB-초 (미국 동부 기준)
- 비용: 368,000 × $0.0000025 = **$0.92/월**

---

### 7. Firebase Cloud Messaging (FCM)

**알림 발송:**
- 보호자 알림: 1,500,000건/월 (보호대상자 기록 시)
- **비용: 무료** ✅ (FCM은 무제한 무료)

---

### 8. 로컬 알림 (보호대상자)

**알림 발송:**
- 매일 19:00 로컬 알림: 50,000명 × 30일 = 1,500,000건/월
- **비용: 무료** ✅ (로컬 알림, Firebase 비용 없음)

---

## 총 비용 계산

| 항목 | 월 사용량 | 무료 할당량 | 초과분 | 월 비용 (USD) | 월 비용 (KRW) |
|------|----------|------------|--------|--------------|--------------|
| Authentication SMS | 9,500건 | 10,000건 | 0건 | $0.00 | 0원 |
| Firestore 읽기 | 9,875,000회 | 1,500,000회 | 8,375,000회 | $2.51 | 3,263원 |
| Firestore 쓰기 | 1,675,000회 | 600,000회 | 1,075,000회 | $0.97 | 1,261원 |
| Firestore 저장 | 300 MB | 1 GB | 0 GB | $0.00 | 0원 |
| Cloud Functions GB-초 | 768,000 | 400,000 | 368,000 | $0.92 | 1,196원 |
| Cloud Functions 실행 | 1,500,000회 | 2,000,000회 | 0회 | $0.00 | 0원 |
| FCM | 무제한 | 무제한 | - | $0.00 | 0원 |
| 로컬 알림 | 무제한 | 무제한 | - | $0.00 | 0원 |
| **총계** | - | - | - | **$4.40** | **약 5,720원** |

**환율 기준**: 1 USD = 1,300 KRW

---

## 비용 분석

### 주요 비용 항목
1. **Firestore 읽기**: $2.51/월 (57.0%)
2. **Firestore 쓰기**: $0.97/월 (22.0%)
3. **Cloud Functions GB-초**: $0.92/월 (20.9%)

### 비용 효율성
- **회원당 월 비용**: $4.40 / 100,000 = **$0.000044** (약 **0.057원**)
- **보호대상자당 월 비용**: $4.40 / 50,000 = **$0.000088** (약 **0.114원**)

---

## 비용 최적화 방안

### 1. Firestore 읽기 최적화 (가장 중요)

**현재 문제:**
- 앱 내부 조회가 많음 (보호대상자/보호자 화면 조회)
- Cloud Functions에서 보호자별 개별 문서 조회

**최적화 방안:**
- 보호자 토큰을 `subjects/{subjectId}` 문서에 캐시하여 읽기 감소
- 앱 내부 조회 최적화 (캐싱, 배치 읽기)

**예상 절감:**
- 읽기: 8,375,000회 → 약 3,000,000회
- **절감액: 약 $1.61/월**

### 2. Cloud Functions 실행 시간 최적화

**현재 문제:**
- 평균 실행 시간 2초 (병렬 처리 미흡)

**최적화 방안:**
- 보호자별 FCM 발송을 병렬 처리로 개선
- 실행 시간: 2초 → 1초로 단축

**예상 절감:**
- GB-초: 768,000 → 384,000 (무료 할당량 내)
- **절감액: $0.92/월**

### 3. Firestore 쓰기 최적화

**현재 문제:**
- 실패 토큰 제거 시 쓰기 발생 (75,000회)
- 사용자 문서 업데이트 (100,000회)

**최적화 방안:**
- 토큰 제거를 배치 처리로 변경
- 불필요한 문서 업데이트 최소화

**예상 절감:**
- 쓰기: 1,675,000회 → 약 1,500,000회
- 초과분: 1,075,000회 → 900,000회
- **절감액: 약 $0.16/월**

---

## 최적화 후 총 비용

| 항목 | 최적화 전 | 최적화 후 | 절감액 |
|------|----------|----------|--------|
| Firestore 읽기 | $2.51 | $0.90 | $1.61 |
| Firestore 쓰기 | $0.97 | $0.81 | $0.16 |
| Cloud Functions GB-초 | $0.92 | $0.00 | $0.92 |
| **총계** | **$4.40** | **$1.71** | **$2.69** |

**한화 환산:**
- 최적화 전: 약 5,720원/월
- 최적화 후: 약 2,223원/월
- **절감액: 약 3,497원/월 (61.1% 절감)**

---

## 결론

### 현재 구조 (최적화 전)
- **월 비용: 약 5,720원** ($4.40)
- **회원당 월 비용: 약 0.057원**
- 주요 비용: Firestore 읽기 (57%), Firestore 쓰기 (22%), Cloud Functions (21%)

### 최적화 후
- **월 비용: 약 2,223원** ($1.71)
- **회원당 월 비용: 약 0.022원**
- 거의 무료 수준 (무료 할당량 내에서 대부분 처리)

### 주요 특징
1. **FCM은 완전 무료**: 알림 발송 비용 없음
2. **로컬 알림 무료**: 보호대상자 알림 비용 없음
3. **Authentication 무료**: 월 10,000회까지 무료 (초기 런칭 시 충분)
4. **비용이 매우 낮음**: 10만명 기준 월 5,720원
5. **최적화 가능**: 코드 개선으로 약 61% 비용 절감 가능

### 권장 사항
1. **Firestore 읽기 최적화** (보호자 토큰 캐싱, 앱 내부 조회 최적화)
2. **Cloud Functions 병렬 처리** (실행 시간 단축)
3. **비용 모니터링 설정** (Firebase Console)
4. **정기적인 비용 리뷰** (월 1회)

---

## 참고사항

- 위 비용은 **미국 동부(us-central1)** 기준입니다
- 다른 지역(아시아, 유럽)은 가격이 다를 수 있습니다
- 실제 사용량은 사용자 행동 패턴에 따라 달라질 수 있습니다
- 무료 할당량은 프로젝트당 1개 데이터베이스에만 적용됩니다
- Authentication SMS는 성공한 인증만 카운트됩니다 (실패한 인증은 비용 없음)

---

## 추가 시나리오

### 시나리오 A: 월 가입 20,000명
- Authentication SMS: 19,000건 성공
- 무료 할당량: 10,000건
- 초과분: 9,000건
- 비용: 9,000 × $0.06 = **$540/월** (약 702,000원)

### 시나리오 B: 월 가입 5,000명
- Authentication SMS: 4,750건 성공
- 무료 할당량: 10,000건
- 초과분: 0건
- 비용: **$0.00/월** ✅

### 시나리오 C: 1년 후 누적 저장량
- Firestore 저장: 3.6 GB
- 무료 할당량: 1 GB
- 초과분: 2.6 GB
- 비용: 2.6 × $0.18 = **$0.468/월** (약 608원)

**1년 후 총 비용 (월 가입 10,000명 기준):**
- 기존 비용: $4.40
- 저장 비용 추가: $0.47
- **총계: 약 $4.87/월** (약 6,331원)
