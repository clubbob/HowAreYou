# 지금 어때? (HowAreYou) - GPT 검증용 서비스 내용

**작성일**: 2026년 2월 6일  
**최종 수정일**: 2026년 2월 6일 (기록 조회 확장 기능 추가)  
**버전**: 2.3  
**프로젝트 ID**: howareyou-1c5de

---

## 📋 서비스 개요

### 서비스명
**지금 어때? (How Are You?)**

### 목적
독거노인 등 혼자 지내는 사용자가 부담 없이 하루 1회 간단히 컨디션을 기록할 수 있는 안부 기록 앱입니다. 보호자(부모, 자녀, 배우자 등)는 연결된 경우에만 최근 7일 기록을 확인할 수 있습니다.

### 핵심 가치
- **감시하지 않는다**: 보호자가 보호대상자의 상세한 위치나 활동을 추적하지 않음
- **판단하지 않는다**: 상태 응답에 대한 평가나 판단을 하지 않음
- **선택적 공유**: 보호대상자가 원할 때만 상태를 공유하고, 보호자는 직접 앱에서 확인
- **부담 없는 기록**: 보호대상자에게는 "알려주는 행위"가 아닌 "본인을 위한 기록 행위"로 인식

---

## 👥 타겟 사용자

### 보호대상자 (Subject)
- 독거노인, 혼자 지내는 사용자
- 하루 1회 간단히 컨디션을 기록하고 싶은 사용자
- 스마트폰 사용이 가능한 사용자
- **핵심 인식**: 보호자에게 알려주는 행위가 아닌, 본인을 위한 기록 행위

### 보호자 (Guardian)
- 부모, 자녀, 배우자 등 연락 담당자
- 보호대상자의 안부를 확인하고 싶은 사용자
- 여러 보호대상자를 관리할 수 있음

### 역할 중복
- 한 사용자가 보호대상자이면서 동시에 보호자 역할도 수행 가능
- 앱 내에서 역할 모드를 전환하여 사용

---

## 🎯 핵심 기능

### 1. 컨디션 기록 (보호대상자)
- **버튼명**: "오늘 컨디션 기록하기" (기존 "상태 알려주기"에서 변경)
- **빈도**: 하루 1회 (24시 기준)
- **기록 내용**:
  - 기분 선택: 😊 좋아, 🙂 괜찮아, 😐 보통, 🙁 별로, 😞 힘들어
  - 선택적 메모 (😞 선택 시)
- **완료 메시지**: "오늘 상태를 남겼어요." 또는 "기록되었습니다." (기존 "고마워요"에서 변경)
- **목적**: 보호대상자에게는 "알려주는 행위"가 아닌 "본인을 위한 기록 행위"로 인식

### 2. 보호자 연결
- **보호대상자 → 보호자**: 보호대상자가 보호자 전화번호로 검색하여 연결
- **보호자 → 보호대상자**: 보호자가 초대 링크를 생성하여 보호대상자에게 전송
- **양방향 초대**: 두 방향 모두 지원 (딥링크 + Play Install Referrer)

### 3. 상태 확인 (보호자)
- **기본 조회 범위**: 최근 7일까지만 조회 가능
- **확장 조회**: "더 보기 (최근 30일)" 버튼으로 최근 30일까지 확장 가능
- **공유 정보**: 날짜 기준만 공유 (정확한 응답 시각은 공유되지 않음)
- **화면**: 보호 대상 관리 화면에서 각 보호대상자별 카드로 표시

### 4. 기록 조회 (보호대상자)
- **버튼명**: "최근 컨디션" (기존 "내 상태 보기"에서 변경)
- **기본 내용**: 최근 7일 기록 차트 및 테이블
- **확장 기능**: "더 보기 (최근 30일)" 버튼으로 최근 30일까지 확장 가능
- **요약 문구**: 조회 범위에 따라 동적 변경 (예: "최근 7일 중 5일은 '괜찮아' 상태였습니다." 또는 "최근 30일 중 20일은 '괜찮아' 상태였습니다.")
- **안내 배너**: 조회 범위에 따라 "이 화면에서 최근 7일 기록을 확인할 수 있습니다." 또는 "이 화면에서 최근 30일 기록을 확인할 수 있습니다."로 동적 변경

---

## 📱 주요 화면

### 1. 역할 선택 화면 (HomeScreen)
- **제목**: "지금 어때?"
- **기능**: "보호대상자 모드" / "보호자 모드" 버튼
- **자동 복원**: 마지막 선택 모드 기억

### 2. 보호대상자 모드 화면 (SubjectModeScreen)
- **제목**: "보호대상자 모드"
- **주요 버튼**:
  - "오늘 컨디션 기록하기"
  - "보호자 지정"
  - "최근 컨디션"
- **설명 문구**: "하루 한 번, 기록으로 안부를 전할 수 있어요."
- **최초 진입 시**: 환영 다이얼로그 표시 (최초 1회만)
  - 내용: "하루 한 번, 기록으로 안부를 전할 수 있어요.\n\n간단히 컨디션을 기록해 두세요."

### 3. 컨디션 기록 화면 (QuestionScreen)
- **제목**: "오늘 컨디션 기록하기" (기존 "상태 알려주기"에서 변경)
- **기능**: 기분 선택 (5가지) + 선택적 메모
- **완료 후**: "오늘 상태를 남겼어요." 메시지 표시

### 4. 최근 컨디션 화면 (SubjectMyStatusScreen)
- **제목**: "최근 컨디션" (기존 "내 상태 보기"에서 변경)
- **기본 내용**: 
  - 안내 배너: "이 화면에서 최근 7일 기록을 확인할 수 있습니다." (확장 시 "최근 30일"로 변경)
  - 최근 7일 요약 문구
  - 최근 7일 차트 (fl_chart)
  - 최근 7일 테이블
- **확장 기능**:
  - "더 보기 (최근 30일)" 버튼 클릭 시 최근 30일 데이터 로드
  - 확장 후 요약 문구, 차트, 테이블이 모두 30일 기준으로 업데이트
  - 제목도 "최근 7일 이력" → "최근 30일 이력"으로 자동 변경

### 5. 보호자 모드 화면 (GuardianModeScreen)
- **제목**: "보호자 모드"
- **기능**: "보호 대상 확인" 버튼

### 6. 보호 대상 관리 화면 (GuardianDashboardScreen)
- **제목**: "보호 대상 관리"
- **기능**:
  - 해석 가이드 안내: "이 정보는 참고용이며, 판단이나 조치를 의미하지 않습니다."
  - 안전 신호 안내: "최근 기록이 있다는 것은, 일상적인 활동이 있었다는 신호로 이해할 수 있습니다."
  - 보호대상자 목록 (카드 형태)
  - 각 보호대상자별 최근 상태 표시
  - "초대 링크 보내기" 버튼
  - "보호 대상 추가" 버튼

### 7. 보호자 지정 화면 (GuardianScreen)
- **제목**: "보호자 지정"
- **기능**: 전화번호로 보호자 검색 및 추가

### 8. 보호 대상 상세 화면 (SubjectDetailScreen)
- **제목**: "보호 대상 상태"
- **기본 기능**:
  - 해석 가이드 안내: "이 정보는 참고용이며, 판단이나 조치를 의미하지 않습니다."
  - 안전 신호 안내: "최근 기록이 있다는 것은, 일상적인 활동이 있었다는 신호로 이해할 수 있습니다."
  - 오늘 상태 표시
  - 최근 7일 이력 테이블
- **확장 기능**:
  - "더 보기 (최근 30일)" 버튼 클릭 시 최근 30일 데이터 로드
  - 확장 후 테이블 제목이 "최근 7일 이력" → "최근 30일 이력"으로 자동 변경

---

## 🔔 알림 시스템

### 보호대상자 알림 (로컬 알림)
- **유형**: 로컬 알림 (앱 내부 스케줄링)
- **발송 시간**: 매일 18:00 (한국 시간, 저녁 시간)
- **발송 횟수**: 하루 1회
- **알림 내용**:
  - 제목: "지금 어때?"
  - 내용: "오늘 컨디션을 기록해 주세요."
- **알림 탭 시**: 질문 화면으로 이동
- **권한 요청**: 보호대상자 모드 진입 시 요청
  - 메시지: "하루 한 번 컨디션 기록 알림을 받으려면 알림 권한이 필요해요."

### 보호자 알림 (FCM 푸시 알림)
- **유형**: FCM 푸시 알림
- **트리거**: 보호대상자가 컨디션을 기록했을 때
- **알림 내용**:
  - 제목: "상태 확인 알림"
  - 내용: "OO님이 오늘 컨디션을 기록했습니다"
- **알림 탭 시**: 보호 대상 관리 화면으로 이동
- **권한 요청**: 보호자 모드 또는 보호 대상 관리 화면 진입 시 요청
  - 메시지: ""보호대상자"가 상태를 등록한 경우 "보호자"께 알림을 보내도록 허용하시겠습니까?"

### 알림 권한 요청 정책
- **통일된 정책**: 보호대상자와 보호자 모두 각 모드 진입 시에만 알림 권한을 요청
- **역할 선택 화면**: 권한 요청하지 않음

---

## 🔗 초대 링크 시스템

### 보호자 → 보호대상자 초대
- **링크 생성**: 보호자가 "초대 링크 보내기" 버튼 클릭
- **링크 형식**: `https://howareyou-1c5de.web.app/invite?type=subject&guardianId={guardianId}&subjectPhone={subjectPhone}`
- **공유 메시지**: "하루 한 번 컨디션만 기록하는 앱이에요."
- **처리 방식**:
  - 앱 설치됨: 딥링크로 처리
  - 앱 미설치: Play Store 이동 후 Install Referrer로 처리

### 보호대상자 → 보호자 초대
- **링크 생성**: 보호대상자가 "보호자 지정" 화면에서 생성
- **링크 형식**: `https://howareyou-1c5de.web.app/invite?type=guardian&subjectId={subjectId}&guardianPhone={guardianPhone}`
- **공유 메시지**: "하루 한 번 컨디션만 기록하는 앱이에요. 링크 누르고 앱 깔면 내 기록을 확인할 수 있어요 (이미 깔았어도 됨)."
- **처리 방식**: 동일 (딥링크 + Install Referrer)

---

## 💾 데이터 모델

### Firestore 컬렉션 구조

#### users/{uid}
- **문서 ID**: Firebase Auth UID
- **필드**:
  - `phone`: 전화번호
  - `displayName`: 표시 이름
  - `fcmTokens`: FCM 토큰 배열 (여러 기기 지원)
  - `role`: 역할 (선택적)

#### subjects/{subjectId}
- **문서 ID**: 보호대상자의 Firebase Auth UID (users/{uid}와 동일)
- **필드**:
  - `displayName`: 보호대상자 이름
  - `phone`: 전화번호
  - `pairedGuardianUids`: 연결된 보호자 UID 배열

#### subjects/{subjectId}/prompts/{date}
- **문서 ID**: 날짜 (yyyy-MM-dd 형식)
- **필드**:
  - `slot`: "daily" (하루 1회)
  - `mood`: 기분 (1~5)
  - `answeredAt`: 응답 시각
  - `note`: 선택적 메모

---

## 🔒 보안 규칙

### 기본 원칙
- **인증 필수**: 모든 읽기/쓰기는 인증된 사용자만 가능
- **본인 문서**: 사용자는 자신의 `users/{uid}` 문서만 읽기/쓰기 가능
- **보호대상자 문서**: 본인 또는 연결된 보호자만 읽기 가능
- **응답 문서**: 보호대상자 본인은 읽기/쓰기, 보호자는 읽기만 가능

### 주요 규칙
- 보호대상자는 자신의 `subjects/{subjectId}/prompts` 문서 읽기/쓰기 가능
- 보호자는 연결된 보호대상자의 `subjects/{subjectId}/prompts` 문서 읽기만 가능 (최근 7일)
- 보호자는 `subjects/{subjectId}` 문서의 `pairedGuardianUids`에 자신을 추가 가능

---

## 🛠 기술 스택

### 프론트엔드
- **Flutter**: 크로스 플랫폼 앱 개발 (Android/iOS)
- **상태 관리**: Provider 패턴
- **주요 패키지**:
  - `firebase_auth`: 전화번호 OTP 인증
  - `cloud_firestore`: NoSQL 데이터베이스
  - `firebase_messaging`: FCM 푸시 알림
  - `flutter_local_notifications`: 로컬 알림
  - `app_links`: 딥링크 처리
  - `fl_chart`: 차트 표시

### 백엔드 & 인프라
- **Firebase Authentication**: 전화번호 OTP 인증
- **Cloud Firestore**: NoSQL 데이터베이스
- **Firebase Cloud Messaging (FCM)**: 푸시 알림 (무료)
- **Firebase Cloud Functions**: 서버리스 백엔드 로직 (Node.js 20)
- **Firebase Hosting**: 웹 초대 페이지 호스팅

### Cloud Functions
- **onResponseCreated**: 보호대상자가 컨디션 기록 시 보호자에게 알림 발송
- **onResponseUpdated**: 보호대상자가 컨디션 수정 시 보호자에게 알림 발송

---

## 📊 비용 구조

### 10만명 기준 월 비용
- **Firestore 읽기**: $0.68 (884원)
- **Firestore 쓰기**: $0.88 (1,144원)
- **Cloud Functions GB-초**: $0.92 (1,196원)
- **FCM**: 무료
- **총계**: 약 **$2.48/월 (3,224원)**

### 비용이 낮은 이유
1. **FCM은 완전 무료**: 알림 발송 비용 없음
2. **Firebase 무료 할당량이 큼**: 대부분의 사용량이 무료 할당량 내
3. **사용 패턴이 단순**: 보호대상자가 하루 1회만 기록

---

## 🎨 주요 UI/UX 변경사항

### 용어 변경
- "상태 알려주기" → "오늘 컨디션 기록하기"
- "내 상태 보기" → "최근 컨디션"
- "고마워요" → "오늘 상태를 남겼어요."

### 메시지 변경
- **초대 링크 공유 메시지**: 덜 강요하는 톤으로 변경
- **보호대상자 환영 메시지**: "하루 한 번, 기록으로 안부를 전할 수 있어요."
- **보호대상자 설명 문구**: "하루 한 번, 기록으로 안부를 전할 수 있어요."

### 제거된 기능
- **미회신 자동 체크**: 보호자가 직접 앱에서 확인
- **보호자 → 보호대상자 알림**: 보호자가 보호대상자에게 알림을 보내는 기능 없음

---

## ✅ 검증 포인트

### 1. 사용자 인식 전환
- ✅ 보호대상자에게는 "알려주는 행위"가 아닌 "본인을 위한 기록 행위"로 인식되도록 용어 및 메시지 변경
- ✅ 모든 UI 문구가 "기록" 중심으로 통일
- ✅ 지속 동기 보완: "기록이 있으면 보호자는 별도로 확인하지 않아도 됩니다" 문구 추가

### 2. 알림 시스템
- ✅ 보호대상자: 매일 18:00 로컬 알림 (하루 1회)
- ✅ 보호자: 보호대상자 기록 시 FCM 알림
- ✅ 알림 권한 요청이 각 모드 진입 시에만 발생 (통일된 정책)

### 3. 초대 시스템
- ✅ 양방향 초대 지원 (보호자 ↔ 보호대상자)
- ✅ 딥링크 + Play Install Referrer로 앱 설치 여부와 관계없이 처리

### 4. 보안 및 개입 방지
- ✅ 보호자는 기본적으로 최근 7일까지만 조회 가능 (확장 시 최근 30일까지)
- ✅ 정확한 응답 시각은 공유되지 않음 (날짜 기준만)
- ✅ 보호자 화면에 해석 가이드 문구 추가: "이 정보는 참고용이며, 판단이나 조치를 의미하지 않습니다"
- ✅ 안전 신호 명문화: "최근 기록이 있다는 것은, 일상적인 활동이 있었다는 신호로 이해할 수 있습니다"

### 5. 기록 조회 확장 기능
- ✅ 기본 조회 범위: 최근 7일
- ✅ "더 보기 (최근 30일)" 버튼으로 선택적 확장 가능
- ✅ 보호대상자와 보호자 화면 모두에 적용
- ✅ 확장 시 모든 UI 요소(제목, 요약, 차트, 테이블)가 30일 기준으로 자동 업데이트
- ✅ 비용 효율적: 기본 7일만 조회하여 비용 절감, 필요 시에만 확장

### 6. 기록 회수 가능성
- ✅ 보호대상자 기록 화면에 안내 배너 추가: "이 화면에서 최근 7일 기록을 확인할 수 있습니다." (확장 시 "최근 30일"로 변경)
- ✅ 기록이 사라지지 않고 쌓인다는 인식 형성

### 7. AI 사용 정책
- ✅ AI는 평가·지도·판단 금지
- ✅ AI는 사실 요약, 패턴 반사, 시간 지연형 피드백만 허용
- ✅ 보호자 화면에는 AI 분석 결과 표시하지 않음

### 8. 비용 효율성
- ✅ 10만명 기준 월 3,224원 수준의 매우 낮은 비용 (기본 7일 조회 기준)
- ✅ "더 보기" 기능으로 선택적 확장 시에도 비용 증가 최소화
- ✅ FCM 무료 활용

---

## 🤖 AI 사용 가이드

### 기본 원칙
- AI는 상태 평가, 조언, 지도, 위험 판단, 감정 명명, 행동 유도를 하지 않는다
- AI는 기록 요약기/패턴 반사기로만 동작한다
- AI가 사라져도 서비스의 의미가 유지되어야 한다

### 허용되는 AI 역할
1. **사실 기반 요약**: "최근 7일 중 4일은 '괜찮아'를 기록했습니다"
2. **패턴 반사**: "최근 기록은 주로 저녁 시간대에 남겨졌습니다"
3. **시간 지연형 피드백**: "지난주 이맘때는 '보통'을 기록했어요"

### 금지되는 AI 표현
- ❌ "우울해 보입니다"
- ❌ "이렇게 해보세요"
- ❌ "전문가 상담이 필요합니다"
- ❌ "내일도 꼭 기록해 주세요"

자세한 내용은 `docs/AI-사용-가이드.md` 참고

---

## 📝 참고사항

- 위 내용은 2026년 2월 6일 기준 최신 버전입니다
- 실제 구현은 코드베이스를 참고하세요
- 비용은 미국 동부(us-central1) 기준입니다
- AI 사용 가이드는 `docs/AI-사용-가이드.md` 참고
