# Cloud Functions 비용 분석

## 사용자의 우려

"전날 아침/점심/저녁 모두 응답 안하고 오늘 점심도 응답 안하면 그 시간 동안 서버가 계속 트레킹을 하기 때문에 서버 비용이 많이 나오는 거 아니야?"

## 실제 동작 방식

### ❌ 잘못된 이해
- 서버가 계속 트레킹하고 있음 (24시간 실행)
- 응답이 없을 때마다 비용 발생

### ✅ 실제 동작
- **매일 12:00에 한 번만 실행** (Cloud Scheduler)
- 실행 시간: **몇 초** (보통 1-5초)
- 실행 후 종료 (계속 실행되지 않음)

## 비용 구조

### Cloud Functions 과금 방식
- **실행 시간** × **메모리 사용량** = GB-초
- 실행하지 않으면 비용 없음

### 무료 할당량 (매월)
- **실행 횟수**: 200만 회 무료
- **실행 시간**: 400,000 GB-초 무료
- **네트워크**: 5GB 무료

### 예상 비용 계산

**미회신 판단 함수 실행:**
- 실행 시간: 약 2-5초
- 메모리: 256MB (기본값)
- GB-초: 0.256 GB × 5초 = 1.28 GB-초

**월 사용량:**
- 매일 1회 × 30일 = 30회 실행
- 총 GB-초: 1.28 × 30 = 38.4 GB-초

**→ 무료 할당량 400,000 GB-초 내에서 충분히 무료입니다!**

## 실제 비용 시나리오

### 시나리오 1: 소규모 사용 (보호 대상 10명)
- 미회신 판단: 월 30회 실행 = 약 38 GB-초
- 응답 알림: 월 900회 실행 = 약 1,152 GB-초
- **총 비용: 무료**

### 시나리오 2: 중규모 사용 (보호 대상 100명)
- 미회신 판단: 월 30회 실행 = 약 38 GB-초
- 응답 알림: 월 9,000회 실행 = 약 11,520 GB-초
- **총 비용: 무료**

### 시나리오 3: 대규모 사용 (보호 대상 1,000명)
- 미회신 판단: 월 30회 실행 = 약 38 GB-초
- 응답 알림: 월 90,000회 실행 = 약 115,200 GB-초
- **총 비용: 무료**

### 시나리오 4: 초대규모 사용 (보호 대상 10,000명)
- 미회신 판단: 월 30회 실행 = 약 38 GB-초
- 응답 알림: 월 900,000회 실행 = 약 1,152,000 GB-초
- **총 비용: 무료** (여전히 무료 할당량 내)

## 비용 최적화 방안

### 1. 함수 실행 시간 최소화
현재 코드는 이미 최적화되어 있습니다:
- 필요한 subjects만 조회
- 병렬 처리 가능한 구조
- 빠른 종료

### 2. 메모리 사용량 최소화
- 기본 메모리(256MB) 사용
- 필요 시 128MB로 낮춤 (더 느릴 수 있음)

### 3. 실행 빈도 조정
- 현재: 매일 12:00 한 번
- 변경 가능: 필요 시에만 실행 (하지만 스케줄러가 더 효율적)

## 결론

### ✅ 비용 걱정 없음
- Cloud Functions는 **실행 시간에만 과금**됩니다
- 계속 실행되지 않고, **매일 12:00에 몇 초만 실행**됩니다
- 무료 할당량이 충분히 커서 일반적인 사용에서는 **비용이 발생하지 않습니다**

### 📊 실제 사용량 예시
- 보호 대상 100명 기준
- 월 실행 시간: 약 11,558 GB-초
- 무료 할당량: 400,000 GB-초
- **사용률: 약 2.9%** (무료 할당량의 3%도 안 됨)

### 💡 참고
- Cloud Functions는 "서버리스" 방식입니다
- 실행하지 않으면 비용이 전혀 발생하지 않습니다
- 실행 시간에만 과금되므로 매우 효율적입니다

## 추가 정보

- Firebase Console → Functions → Usage에서 실제 사용량 확인 가능
- 무료 할당량 초과 시에만 비용 발생 (매우 드묾)
- 비용 알림 설정 가능 (Firebase Console → Usage and billing)
