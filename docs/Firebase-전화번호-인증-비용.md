# Firebase 전화번호 인증 (OTP) 비용 및 동작 방식

## 📱 동작 방식

### 1. 매번 다른 인증 코드 발송
**네, 맞습니다!** Firebase는 매번 다른 6자리 인증 코드를 생성하여 SMS로 발송합니다.

**예시:**
- 1회 로그인: "Your verification code is 123456"
- 2회 로그인: "Your verification code is 789012"
- 3회 로그인: "Your verification code is 345678"

각 인증 코드는 **일회용**이며, 보통 **5-10분 내에 만료**됩니다.

---

## 💰 비용 구조

### 무료 할당량 (Blaze 플랜 기준)

**매월 10,000회 성공한 인증까지 무료** ⚠️ **회수 기준, 금액 기준 아님**

- ✅ **매월 초기화됨**: 매월 1일부터 다시 10,000회 무료 할당량 제공
- ✅ **누적되지 않음**: 전월 사용량과 관계없이 매월 10,000회 무료
- ⚠️ **중요**: 무료 할당량은 "회수" 기준입니다. "금액" 기준이 아닙니다.
- 성공한 인증만 카운트됨
- SMS가 발송되었지만 인증에 실패한 경우는 비용 없음
- 테스트용: 하루 10개 SMS 무료 (개발 중 테스트용)

**올바른 이해:**
- 매월 10,000회까지: **무료 (0원)**
- 10,001회부터: **회당 78원**

**잘못된 이해 (X):**
- ❌ "매월 78만원(10,000회 × 78원)까지 무료"
- ❌ 금액 기준이 아닙니다!

**예시:**
- 1월: 9,000회 로그인 → **무료 (0원)** (10,000회 이하)
- 2월: 9,000회 로그인 → **무료 (0원)** (10,000회 이하, 매월 초기화)
- 3월: 12,000회 로그인 → **10,000회 무료 + 2,000회 유료 = 156,000원**
- **→ 매월 10,000회 이하면 계속 무료 (0원)!**

### 무료 할당량 초과 시 비용

**지역별 가격 (성공한 인증당):**

| 지역 | 비용 (USD) | 비용 (KRW, 1 USD = 1,300원 기준) |
|------|-----------|--------------------------------|
| 미국, 캐나다, 인도 | $0.01 | 약 13원 |
| 기타 국가 (한국 포함) | $0.06 | 약 78원 |

**한국 기준:**
- 월 10,000회까지: **무료 (0원)**
- 10,001회부터: **인증당 약 78원**

**비용 계산 예시:**
- 10,000회: **0원** (무료 할당량)
- 10,001회: **78원** (1회 초과)
- 11,000회: **78,000원** (1,000회 초과 × 78원)
- 20,000회: **780,000원** (10,000회 초과 × 78원)

---

## 📊 실제 비용 예시

### 시나리오 1: 소규모 서비스 (월 1,000명 로그인)
- 성공한 인증: 1,000회
- **비용: 무료** (10,000회 무료 할당량 내)
- **매월 1,000회면 계속 무료**

### 시나리오 2: 중규모 서비스 (월 5,000명 로그인)
- 성공한 인증: 5,000회
- **비용: 무료** (10,000회 무료 할당량 내)
- **매월 5,000회면 계속 무료**

### 시나리오 2-1: 중규모 서비스 (월 9,000명 로그인)
- 성공한 인증: 9,000회
- **비용: 무료** (10,000회 무료 할당량 내)
- **매월 9,000회면 계속 무료** ✅

### 시나리오 3: 대규모 서비스 (월 15,000명 로그인)
- 성공한 인증: 15,000회
- 무료 할당량: 10,000회 (0원)
- 초과분: 5,000회
- **비용: 5,000 × $0.06 = $300/월 (약 390,000원/월)**
- **총 비용: 0원(무료) + 390,000원(초과) = 390,000원/월**

### 시나리오 4: 초대규모 서비스 (월 100,000명 로그인)
- 성공한 인증: 100,000회
- 무료 할당량: 10,000회 (0원)
- 초과분: 90,000회
- **비용: 90,000 × $0.06 = $5,400/월 (약 7,020,000원/월)**
- **총 비용: 0원(무료) + 7,020,000원(초과) = 7,020,000원/월**

### 시나리오 7: 1만명 사용자, 월 4회 로그인 (실제 서비스 시나리오)
- 사용자 수: 10,000명
- 월 로그인 횟수: 4회/사용자
- **총 성공한 인증: 10,000명 × 4회 = 40,000회**
- 무료 할당량: 10,000회 (0원)
- 초과분: 30,000회
- **비용: 30,000 × $0.06 = $1,800/월 (약 2,340,000원/월)**
- **총 비용: 0원(무료) + 2,340,000원(초과) = 약 234만원/월** 💰

**비용 최적화 방안:**
- 사용자가 한 번 로그인하면 자동 로그인 유지 (재인증 최소화)
- 토큰 갱신으로 재인증 방지
- 예상: 월 4회 → 월 1-2회로 감소 가능
  - 월 1회: 10,000회 → **무료**
  - 월 2회: 20,000회 → 10,000회 초과 = **약 78만원/월**

### 시나리오 5: 정확히 10,000회 로그인
- 성공한 인증: 10,000회
- 무료 할당량: 10,000회
- 초과분: 0회
- **비용: 0원 (완전 무료)** ✅

### 시나리오 6: 10,001회 로그인 (1회만 초과)
- 성공한 인증: 10,001회
- 무료 할당량: 10,000회 (0원)
- 초과분: 1회
- **비용: 1 × $0.06 = $0.06/월 (약 78원/월)**
- **총 비용: 0원(무료) + 78원(초과) = 78원/월**

---

## 🔌 통신사 연계 필요 여부

### ✅ **통신사와 직접 연계 불필요**

Firebase Authentication은 **Google이 직접 처리**합니다:

1. **Firebase가 SMS 발송을 담당**
   - Google의 SMS 발송 인프라 사용
   - 전 세계 통신사와 이미 연계되어 있음
   - 개발자가 별도로 SK/LG/KT와 계약할 필요 없음

2. **자동 처리**
   - 전화번호만 입력하면 자동으로 SMS 발송
   - 통신사 구분 없이 동일하게 동작
   - 국내 통신사(SK, LG, KT) 모두 지원

3. **개발자 작업 불필요**
   - 통신사 API 연동 코드 작성 불필요
   - 통신사 계약 및 설정 불필요
   - Firebase Console에서 활성화만 하면 됨

---

## 🎯 실제 사용 시나리오

### 사용자 A (SKT 사용자)
1. 앱에서 전화번호 입력: `01012345678`
2. "인증 코드 전송" 클릭
3. Firebase가 자동으로 SMS 발송
4. SKT 번호로 SMS 수신: "Your verification code is 123456"
5. 코드 입력 후 로그인 완료

### 사용자 B (LG U+ 사용자)
1. 앱에서 전화번호 입력: `01098765432`
2. "인증 코드 전송" 클릭
3. Firebase가 자동으로 SMS 발송
4. LG U+ 번호로 SMS 수신: "Your verification code is 789012"
5. 코드 입력 후 로그인 완료

### 사용자 C (KT 사용자)
1. 앱에서 전화번호 입력: `01055555555`
2. "인증 코드 전송" 클릭
3. Firebase가 자동으로 SMS 발송
4. KT 번호로 SMS 수신: "Your verification code is 345678"
5. 코드 입력 후 로그인 완료

**→ 통신사 구분 없이 모두 동일하게 동작합니다!**

---

## 💡 비용 최적화 팁

### 1. 무료 할당량 활용
- 월 10,000회까지 무료
- 초기 서비스에서는 충분히 무료

### 2. 인증 실패 최소화
- UI에서 명확한 안내 제공
- 잘못된 전화번호 입력 방지
- 인증 코드 만료 시간 안내

### 3. 재인증 최소화
- 로그인 상태 유지 (자동 로그인)
- 토큰 갱신으로 재인증 방지

### 4. 테스트 전화번호 사용 (개발 중)
- Firebase Console에서 테스트 전화번호 등록
- 테스트 번호는 실제 SMS 없이 고정 코드로 인증 가능
- 개발 중 비용 절감

---

## 📋 요약

### ✅ 동작 방식
- **매번 다른 인증 코드** 발송 (6자리, 일회용)
- **5-10분 내 만료**

### ✅ 비용
- **월 10,000회 성공한 인증 무료**
- 초과 시: 한국 기준 **인증당 약 78원**
- 실패한 인증은 비용 없음

### ✅ 통신사 연계
- **통신사와 직접 연계 불필요**
- Firebase가 자동으로 처리
- SK/LG/KT 모두 자동 지원
- 개발자 작업 불필요

### ✅ 결론
- Firebase가 모든 것을 처리하므로 **개발자는 전화번호만 입력받으면 됨**
- 통신사 API 연동, 계약, 설정 모두 불필요
- 초기 서비스에서는 무료 할당량으로 충분

---

**참고 링크:**
- [Firebase Phone Authentication Pricing](https://firebase.google.com/docs/phone-number-verification/pricing)
- [Firebase Authentication Pricing](https://firebase.google.com/pricing)

**작성일**: 2026-01-27
