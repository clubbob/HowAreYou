# 전화번호 인증 동작 예시 (구체적 시나리오)

## 설정
- **보호자**: Pixel 6, 전화번호 `010-1111-2222`
- **보호 대상자**: Pixel 7, 전화번호 `010-3333-4444`

## 시나리오별 동작 방식

### 시나리오 1: 보호자 (Pixel 6)가 자신의 번호로 로그인

#### 1단계: Pixel 6에서 앱 실행
```
[Pixel 6 기기]
    ↓
앱 실행 → 로그인 화면
    ↓
전화번호 입력: "010-1111-2222"
    ↓
"인증 코드 전송" 버튼 클릭
```

#### 2단계: Firebase 처리
```
Firebase 서버:
  - 전화번호 받음: "+821011112222"
  - SMS 발송 요청: "이 번호로 인증 코드 보내줘"
```

#### 3단계: 통신사 처리
```
통신사 (SK/LG/KT):
  - "+821011112222" 번호 찾기
  - "이 번호는 현재 Pixel 6이 사용 중"
  - Pixel 6으로 SMS 전달
```

#### 4단계: SMS 수신 및 인증
```
[Pixel 6 기기]
    ↓
SMS 수신: "Your verification code is 111111"
    ↓
앱에 코드 입력: "111111"
    ↓
로그인 완료 ✅
```

**결과**: Pixel 6에서 Pixel 6의 번호로 로그인 성공

---

### 시나리오 2: 보호 대상자 (Pixel 7)가 자신의 번호로 로그인

#### 1단계: Pixel 7에서 앱 실행
```
[Pixel 7 기기]
    ↓
앱 실행 → 로그인 화면
    ↓
전화번호 입력: "010-3333-4444"
    ↓
"인증 코드 전송" 버튼 클릭
```

#### 2단계: Firebase 처리
```
Firebase 서버:
  - 전화번호 받음: "+821033334444"
  - SMS 발송 요청: "이 번호로 인증 코드 보내줘"
```

#### 3단계: 통신사 처리
```
통신사 (SK/LG/KT):
  - "+821033334444" 번호 찾기
  - "이 번호는 현재 Pixel 7이 사용 중"
  - Pixel 7으로 SMS 전달
```

#### 4단계: SMS 수신 및 인증
```
[Pixel 7 기기]
    ↓
SMS 수신: "Your verification code is 333333"
    ↓
앱에 코드 입력: "333333"
    ↓
로그인 완료 ✅
```

**결과**: Pixel 7에서 Pixel 7의 번호로 로그인 성공

---

### 시나리오 3: 보호자가 다른 기기에서 로그인 (예: 새 폰)

#### 상황: 보호자가 Pixel 6을 새 폰으로 교체 (같은 번호 유지)

#### 1단계: 새 Pixel 6에서 앱 실행
```
[새 Pixel 6 기기]
    ↓
앱 실행 → 로그인 화면
    ↓
전화번호 입력: "010-1111-2222" (자신의 번호)
    ↓
"인증 코드 전송" 버튼 클릭
```

#### 2단계: Firebase 처리
```
Firebase 서버:
  - 전화번호 받음: "+821011112222"
  - SMS 발송 요청: "이 번호로 인증 코드 보내줘"
```

#### 3단계: 통신사 처리
```
통신사 (SK/LG/KT):
  - "+821011112222" 번호 찾기
  - "이 번호는 현재 새 Pixel 6이 사용 중" (번호 이전 완료)
  - 새 Pixel 6으로 SMS 전달
```

#### 4단계: SMS 수신 및 인증
```
[새 Pixel 6 기기]
    ↓
SMS 수신: "Your verification code is 111111"
    ↓
앱에 코드 입력: "111111"
    ↓
로그인 완료 ✅ (기존 계정으로 로그인됨)
```

**결과**: 새 기기에서도 같은 계정으로 로그인 가능

---

### 시나리오 4: 보호자가 보호 대상자 번호로 로그인 시도 (잘못된 경우)

#### 1단계: Pixel 6에서 앱 실행
```
[Pixel 6 기기]
    ↓
앱 실행 → 로그인 화면
    ↓
전화번호 입력: "010-3333-4444" (보호 대상자 번호)
    ↓
"인증 코드 전송" 버튼 클릭
```

#### 2단계: Firebase 처리
```
Firebase 서버:
  - 전화번호 받음: "+821033334444"
  - SMS 발송 요청: "이 번호로 인증 코드 보내줘"
```

#### 3단계: 통신사 처리
```
통신사 (SK/LG/KT):
  - "+821033334444" 번호 찾기
  - "이 번호는 현재 Pixel 7이 사용 중"
  - Pixel 7으로 SMS 전달 (Pixel 6이 아닌!)
```

#### 4단계: SMS 수신 및 인증
```
[Pixel 7 기기]
    ↓
SMS 수신: "Your verification code is 333333"
    ↓
(보호자가 Pixel 6에서 코드를 받지 못함)
    ↓
만약 보호자가 Pixel 7의 코드를 알게 되면:
  - Pixel 6에서 코드 입력: "333333"
  - 로그인 완료 ✅
  - 하지만 보호 대상자의 계정으로 로그인됨!
```

**결과**: 다른 사람의 계정으로 로그인됨 (보안 위험)

---

### 시나리오 5: 보호 대상자가 보호자 번호로 로그인 시도 (잘못된 경우)

#### 1단계: Pixel 7에서 앱 실행
```
[Pixel 7 기기]
    ↓
앱 실행 → 로그인 화면
    ↓
전화번호 입력: "010-1111-2222" (보호자 번호)
    ↓
"인증 코드 전송" 버튼 클릭
```

#### 2단계: Firebase 처리
```
Firebase 서버:
  - 전화번호 받음: "+821011112222"
  - SMS 발송 요청: "이 번호로 인증 코드 보내줘"
```

#### 3단계: 통신사 처리
```
통신사 (SK/LG/KT):
  - "+821011112222" 번호 찾기
  - "이 번호는 현재 Pixel 6이 사용 중"
  - Pixel 6으로 SMS 전달 (Pixel 7이 아닌!)
```

#### 4단계: SMS 수신 및 인증
```
[Pixel 6 기기]
    ↓
SMS 수신: "Your verification code is 111111"
    ↓
(보호 대상자가 Pixel 7에서 코드를 받지 못함)
    ↓
만약 보호 대상자가 Pixel 6의 코드를 알게 되면:
  - Pixel 7에서 코드 입력: "111111"
  - 로그인 완료 ✅
  - 하지만 보호자의 계정으로 로그인됨!
```

**결과**: 다른 사람의 계정으로 로그인됨 (보안 위험)

---

## 핵심 정리

### ✅ 올바른 동작
1. **Pixel 6에서 `010-1111-2222` 입력**
   - → Pixel 6으로 SMS 발송
   - → 보호자 계정으로 로그인

2. **Pixel 7에서 `010-3333-4444` 입력**
   - → Pixel 7으로 SMS 발송
   - → 보호 대상자 계정으로 로그인

### ❌ 잘못된 동작 (보안 위험)
1. **Pixel 6에서 `010-3333-4444` 입력**
   - → Pixel 7으로 SMS 발송
   - → 보호 대상자 계정으로 로그인 (다른 사람 계정!)

2. **Pixel 7에서 `010-1111-2222` 입력**
   - → Pixel 6으로 SMS 발송
   - → 보호자 계정으로 로그인 (다른 사람 계정!)

## 결론

### Firebase는:
- ✅ 입력한 전화번호로만 SMS 발송
- ✅ 어떤 기기에서 입력했는지 모름
- ✅ SMS를 입력한 기기로 보내지 않음

### 통신사가:
- ✅ 전화번호를 찾아서 실제 사용 중인 기기로 SMS 전달
- ✅ 번호-기기 매칭을 관리

### 사용자가 해야 할 것:
- ✅ **자신의 전화번호를 정확히 입력**
- ✅ **자신의 핸드폰으로 받은 인증 코드 입력**
- ❌ 다른 사람의 번호로 로그인 시도 금지

**이것이 Firebase Authentication의 정상 동작 방식입니다!**
